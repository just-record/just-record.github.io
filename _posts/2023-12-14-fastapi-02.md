---
layout: single
title: "FastAPI를 이용 하여 AI 서비스 하기 - 02 (FastAPI: 경로 Parameters)"
categories: FastAPI
tag: [FastAPI, uvicorn]
toc: true
toc_sticky: true
toc_label: "목차"
---
## 경로 Parameters

출처: [https://fastapi.tiangolo.com/tutorial/path-params/](https://fastapi.tiangolo.com/tutorial/path-params/)  

### 경로 Parameters 예시

경로는 호출하는 url의 일부이다.  
<http://127.0.0.1:8000/items/foo>  
`items`와 `foo`가 경로이다.

```python
from fastapi import FastAPI

app = FastAPI()


@app.get("/items/{item_id}")    # 경로의 매개변수 - item_id
async def read_item(item_id):   # 함수의 매개변수 - item_id
    return {"item_id": item_id}
```

경로의 매개 변수(item_id)가 함수의 매개 변수(item_id)로 전달  

 <http://127.0.0.1:8000/items/foo>로 접속

```shell
{"item_id":"foo"}
```

### 경로 Parameters (Data Type)

```python
from fastapi import FastAPI

app = FastAPI()


@app.get("/items/{item_id}")
async def read_item(item_id: int):  # item_id는 int Type으로 변경 됨
    return {"item_id": item_id}
```

경로의 매개 변수(item_id)가 함수의 매개 변수(item_id)로 전달  

 <http://127.0.0.1:8000/items/3>로 접속

```shell
{"item_id":3}
```

<http://127.0.0.1:8000/items/foo>로 접속  
또는  
<http://127.0.0.1:8000/items/3.4>로 접속  
경로의 매개 변수(item_id)가 ***int Type이 아니므로 에러 발생***

```shell
{
  "detail": [
    {
      "type": "int_parsing",
      "loc": [
        "path",
        "item_id"
      ],
      "msg": "Input should be a valid integer, unable to parse string as an integer",
      "input": "foo",
      "url": "https://errors.pydantic.dev/2.1/v/int_parsing"
    }
  ]
}
```

### 함수 작성 순서

`/user/me`와 `/user/{user_id}` 경로가 있다고 가정  
`/user/me`: 현재 로그인한 사용자의 정보를 반환  
`/user/{user_id}`: user_id에 해당하는 사용자의 정보를 반환  
**`/user/me`를 호출 하면 먼저 선언 된 함수가 호출 됨**  

`/user/me`를 선언하고 두 번째로 `/user/{user_id}`를 선언 한 경우

```python
from fastapi import FastAPI

app = FastAPI()


@app.get("/users/me")                       # 먼저 선언 됨
async def read_user_me():
    return {"user_id": "the current user"}  # 반환


@app.get("/users/{user_id}")
async def read_user(user_id: str):
    return {"user_id": user_id}
```

```html
{"user_id":"the current user"}
```

`/user/{user_id}`를 선언하고 두 번째로 `/user/me`를 선언 한 경우

```python
from fastapi import FastAPI

app = FastAPI()


@app.get("/users/{user_id}")        # 먼저 선언 됨
async def read_user(user_id: str):
    return {"user_id": user_id}     # 반환


@app.get("/users/me")
async def read_user_me():
    return {"user_id": "the current user"}
```

```html
{"user_id":"me"}
```

### 경로 Parameter의 사전 선언

사전에 경로 매개 변수 값을 정의 할 수 있다.  

Enum Class 사용

```python
from enum import Enum       # enum 모듈 임포트

from fastapi import FastAPI


class ModelName(str, Enum): # enum Class 선언, 열거형의 항목은 문자열 타입
    alexnet = "alexnet"
    resnet = "resnet"
    lenet = "lenet"


app = FastAPI()


@app.get("/models/{model_name}")
async def get_model(model_name: ModelName):     # 매개 변수(model_name)는 ModelName Type
    if model_name is ModelName.alexnet:     # is 연산자를 사용하여 비교
        return {"model_name": model_name, "message": "Deep Learning FTW!"}

    if model_name.value == "lenet":         # value 속성을 사용하여 비교
        return {"model_name": model_name, "message": "LeCNN all the images"}

    return {"model_name": model_name, "message": "Have some residuals"} # 나머지
```

앞에서 경로 parameters의 패턴과 같음  
`async def read_item(item_id: int)`  

<http://127.0.0.1:8000/models/alexnet>  
또는  
<http://127.0.0.1:8000/models/resnet>  
또는  
<http://127.0.0.1:8000/models/lenet>  

```shell
// alexnet
{"model_name":"alexnet","message":"Deep Learning FTW!"}
// resnet
{"model_name":"resnet","message":"Have some residuals"}
// lenet
{"model_name":"lenet","message":"LeCNN all the images"}
```

만약 아래와 같이 열거형(ModelName)에 없는 값으로 호출 하면  

<http://127.0.0.1:8000/models/vggnet>  

```shell
{
  "detail": [
    {
      "type": "type_error.enum",
      "loc": [
        "path",
        "model_name"
      ],
      "msg": "value is not a valid enumeration member; permitted: 'alexnet', 'resnet', 'lenet'",
      "ctx": {
        "enum_values": [
          "alexnet",
          "resnet",
          "lenet"
        ]
      },
      "param": "alexnet",
      "url": "https://errors.pydantic.dev/1.7.3/"
    }
  ]
}
```

### 경로 변환기

url: `files/home/johndoe/myfile.txt`
url같이 경로를 포함하는 경로 매개변수를 선언 하기

```python
from fastapi import FastAPI

app = FastAPI()


@app.get("/files/{file_path:path}")
async def read_file(file_path: str):
    return {"file_path": file_path}
```

<http://127.0.0.1:8000/files/home/johndoe/myfile.txt>

```html
{"file_path":"home/johndoe/myfile.txt"}
```

해시태그: #fastapi #uvicorn #ubuntu #remote server #port
